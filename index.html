<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ob-havo Ilovasi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            /* Gradient fon */
            background: linear-gradient(135deg, #00feba, #5b548a);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
        }

        .weather-card {
            /* Glassmorphism effekti */
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            /* Box-shadow to'g'irlandi */
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            transition: transform 0.3s ease;
        }

        .weather-card:hover {
            transform: translateY(-5px);
        }

        .search-btn {
            background: white;
            color: #5b548a;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: #5b548a;
            color: white;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #5b548a;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            /* JS tomonidan boshqariladi, boshida yashiriladi */
            display: none; 
        }

        @keyframes spin {
            0% { transform: rotate(0deg);}
            100% { transform: rotate(360deg);}
        }

        .weather-icon {
            font-size: 4rem;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2));
        }
    </style>
</head>

<body class="p-4">

    <div class="weather-card w-full max-w-md p-8 text-center text-white">

        <h1 class="text-3xl font-bold mb-6">Ob-havo</h1>

        <div class="relative flex items-center mb-8">
            <input type="text" id="city-input" placeholder="Shahar nomini kiriting..."
            class="w-full p-3 rounded-full border-none outline-none text-gray-700 pl-4 pr-12 shadow-md focus:ring-2 focus:ring-purple-400">
            <button id="search-btn" class="search-btn absolute right-1 top-1 bottom-1 px-4 rounded-full cursor-pointer shadow-sm">
                <i class="fas fa-search"></i>
            </button>
        </div>
        
        <div id="error-msg" class="hidden bg-red-500/80 p-2 rounded-lg mb-4 text-sm animate-pulse">
            Shahar topilmadi. Qaytadan urinib ko'ring.
        </div>

        <div id="loader" class="loader"></div>

        <div id="weather-data" class="hidden">
            <h2 id="city-name" class="text-2xl font-semibold mb-2">Tashkent</h2>

            <div class="my-6">
                <i id="weather-icon" class="fas fa-cloud weather-icon text-gray-300"></i>
            </div>

            <h1 id="temp" class="text-6xl font-bold mb-2"> 25°C</h1>
            <p id="description" class="text-lg capitalize mb-8 opacity-90">Ochiq havo</p>

            <div class="flex justify-between items-center bg-white/20 rounded-xl p-4">
                
                <div class="flex items-center gap-2">
                    <i class="fas fa-tint text-xl"></i>
                    <div class="text-left">
                        <p class="text-xs opacity-80">Namlik</p>
                        <p id="humidity" class="font-bold">64%</p>
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <i class="fas fa-wind text-xl"></i>
                    <div class="text-left">
                         <p class="text-xs opacity-80">Shamol</p>
                        <p id="wind-speed" class="font-bold">18 km/s</p>
                    </div>
                </div>
                
            </div>
            </div>
        
        <div id="initial-msg" class="mt-4 opacity-80 text-sm">
            Ob-havoni bilish uchun shahar nomini yozing va qidiring.
        </div>
    </div>

<script>
    const searchBtn = document.getElementById('search-btn');
    const cityInput = document.getElementById('city-input');
    const weatherData = document.getElementById('weather-data');
    const errorMsg = document.getElementById('error-msg');
    const loader = document.getElementById('loader');
    const initialMsg = document.getElementById('initial-msg');

    // UI elementlari
    const cityNameEl = document.getElementById('city-name');
    const tempEl = document.getElementById('temp');
    // ID 'description' ga to'g'irlandi
    const descEl = document.getElementById('description'); 
    const humidityEl = document.getElementById('humidity');
    const windSpeedEl = document.getElementById('wind-speed');
    const weatherIconEl = document.getElementById('weather-icon');

    // API URLlari (Open-Meteo + Geocoding)
    const GEOCODING_API_URL = "https://geocoding-api.open-meteo.com/v1/search";
    const WEATHER_API_URL   = "https://api.open-meteo.com/v1/forecast";

    // Hodisalar
    searchBtn.addEventListener('click', () => {
        checkWeather(cityInput.value);
    });

    cityInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            checkWeather(cityInput.value);
        }
    });

    async function checkWeather(city) {
        if (!city.trim()) {
            // Klasslarni to'g'ri boshqarish
            errorMsg.classList.remove('hidden');
            errorMsg.textContent = "Iltimos, shahar nomini kiriting!";
            weatherData.classList.add('hidden');
            initialMsg.classList.add('hidden');
            return;
        }

        // Yuklanishni ko'rsatish va boshqalarni yashirish
        loader.style.display = 'block'; // 'flex' o'rniga 'block' (yoki 'flex', lekin 'block' oddiyroq)
        initialMsg.classList.add('hidden');
        weatherData.classList.add('hidden');
        errorMsg.classList.add('hidden');

        try {
            // 1. Shahar koordinatalarini olish (Geocoding)
            // String litral o'rniga backtick (`) ishlatildi
            const geocodeResponse = await fetch(
                `${GEOCODING_API_URL}?name=${city}&count=1&language=uz&format=json`
            );

            const geocodeData = await geocodeResponse.json();

            if (!geocodeData.results || geocodeData.results.length === 0) {
                throw new Error("Shahar topilmadi!");
            }

            const { latitude, longitude, name } = geocodeData.results[0];

            // 2. Ob-havo ma’lumotlarini olish
            // String litral o'rniga backtick (`) ishlatildi
            // Boshqa ob-havo parametrlarini qo'shdim (current_weather ichida `windspeed` bor)
            const weatherResponse = await fetch(
                `${WEATHER_API_URL}?latitude=${latitude}&longitude=${longitude}&current_weather=true&hourly=relativehumidity_2m,weathercode&timezone=auto`
            );

            const weatherResult = await weatherResponse.json();

            // Open-Meteo API'si bo'yicha eng yaqin soatdagi namlikni olish (joriy soatga eng yaqin)
            const nowHour = new Date().getHours();
            // JORIY SOATGA mos keladigan ma'lumotni topish uchun soddaroq yondashuv
            const humidity = weatherResult.hourly.relativehumidity_2m[nowHour]; 

            // UI yangilash
            // weatherResult.current_weather to'g'ridan-to'g'ri o'tkazildi
            updateUI(name, weatherResult.current_weather, humidity);

        } catch (error) {
            console.error(error);
            errorMsg.textContent = "Shahar topilmadi. Qaytadan urinib ko'ring.";
            errorMsg.classList.remove('hidden');
            weatherData.classList.add('hidden');
        } finally {
            loader.style.display = 'none';
        }
    }

    function updateUI(city, current, humidity) {
        cityNameEl.textContent = city;
        // Harorat birligi to'g'irlandi (°C)
        tempEl.textContent = Math.round(current.temperature) + "°C"; 
        // % belgisi qo'shildi
        humidityEl.textContent = humidity + "%"; 
        // Birlik to'g'irlandi (km/h)
        windSpeedEl.textContent = current.windspeed + " km/h"; 

        // Ob-havo kodi asosida ikonka va matn tanlash
        let code = current.weathercode;
        let iconClass = "";
        let colorClass = "";
        let textDesc = "";

        // WMO kodlari uchun ikonka va matn
        // Open-Meteo WMO kodlari bo'yicha to'liqroq ta'rif
        if (code === 0) {
            iconClass = "fa-sun";
            colorClass = "text-yellow-300";
            textDesc = "Ochiq havo";
        } else if (code === 1 || code === 2 || code === 3) { // Asosan bulut
            iconClass = "fa-cloud-sun";
            colorClass = "text-gray-300";
            textDesc = "Bulutli";
        } else if (code >= 45 && code <= 48) { // Tuman (Fog)
            iconClass = "fa-smog";
            colorClass = "text-gray-300";
            textDesc = "Tuman";
        } else if (code >= 51 && code <= 65) { // Yomg'ir (Drizzle and Rain)
            iconClass = "fa-cloud-showers-heavy";
            colorClass = "text-blue-300";
            textDesc = "Yomg‘ir";
        } else if (code >= 71 && code <= 75) { // Qor (Snow)
            iconClass = "fa-snowflake";
            colorClass = "text-white";
            textDesc = "Qor";
        } else if (code >= 95) { // Momaqaldiroq (Thunderstorm)
            iconClass = "fa-bolt";
            colorClass = "text-yellow-300";
            textDesc = "Momaqaldiroq";
        } else {
             iconClass = "fa-question-circle";
            colorClass = "text-gray-400";
            textDesc = "Noma'lum";
        }

        // Ikonka klasslarini to'g'ri o'rnatish
        weatherIconEl.className = `fas ${iconClass} weather-icon ${colorClass}`;
        descEl.textContent = textDesc;

        loader.style.display = 'none';
        weatherData.classList.remove('hidden');
        errorMsg.classList.add('hidden'); // Ma'lumot topilsa xatoni yashirish
    }
    
    // Sahifa yuklanganda Tashkent ob-havosini avtomatik ko'rsatish
    window.addEventListener('load', () => {
        checkWeather("Tashkent");
    });
</script>
</body>
</html>
